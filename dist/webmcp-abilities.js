!function(){"use strict";if("undefined"==typeof navigator||!("modelContext"in navigator))return;if("undefined"==typeof wmcpBridge)return;const{toolsEndpoint:t,executeEndpoint:n,nonceEndpoint:e}=wmcpBridge;let o=wmcpBridge.nonce;const a="wmcp_tools_cache";!async function(){let r;try{r=await async function(){const n=function(){try{const t=localStorage.getItem(a);if(!t)return null;const{tools:n,etag:e,expiry:o}=JSON.parse(t);return Date.now()>o?(localStorage.removeItem(a),null):{tools:n,etag:e}}catch{return null}}(),e={};let r;n?.etag&&(e["If-None-Match"]=`"${n.etag}"`);try{r=await fetch(t,{headers:e,credentials:"same-origin"})}catch{return n?.tools??[]}if(304===r.status&&n?.tools)return n.tools;if(!r.ok)return n?.tools??[];const i=await r.json(),c=i.tools??[],s=r.headers.get("ETag")?.replace(/"/g,"")??"";return i.nonce&&(o=i.nonce),function(t,n){try{localStorage.setItem(a,JSON.stringify({tools:t,etag:n,expiry:Date.now()+864e5}))}catch{}}(c,s),c}()}catch{return}if(!Array.isArray(r)||0===r.length)return;const i=r.filter(t=>t.name&&t.description).map(t=>{const a={name:t.name.replace(/\//g,"_"),description:t.description,inputSchema:t.inputSchema??{type:"object",properties:{}},execute:async a=>async function(t,a,r=!1){const i=n+encodeURIComponent(t);async function c(t){const n={"Content-Type":"application/json"};return!r&&t&&(n["X-WP-Nonce"]=t),fetch(i,{method:"POST",credentials:"same-origin",headers:n,body:JSON.stringify(a)})}let s=await c(o);if(r||403!==s.status||(await async function(){try{const t=await fetch(e,{credentials:"same-origin"});if(t.ok){const n=await t.json();o=n.nonce??o}}catch{}}(),s=await c(o)),!s.ok){let t=`HTTP ${s.status}`;try{t=(await s.json()).message??t}catch{}throw new Error(`WebMCP Abilities: ${t}`)}const l=await s.json();return{content:[{type:"text",text:JSON.stringify(l.result)}]}}(t.name,a,!!t.annotations?.readOnlyHint)};return t.annotations&&(a.annotations=t.annotations),a});0!==i.length&&navigator.modelContext.provideContext({tools:i})}()}();